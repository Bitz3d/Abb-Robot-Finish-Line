%%%
  VERSION:1
  LANGUAGE:ENGLISH
%%%

MODULE FL5MBG16_65R02

!# ----------------------------------------------
!# ------ ROBTARGET
!# ----------------------------------------------
CONST robtarget pick_65fx02_f56:=[[-381.77,-1.49,606.31],[0.00646769,-0.999915,-0.00939865,0.00616188],[-2,1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget best_fit_65fx01_F56:=[[-368.71,-9.15,604.28],[0.999939,0.00042098,0.0112301,0.000175434],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget drop_65fx01_F56:=[[-368.71,-9.15,604.28],[0.999939,0.000420959,0.0112301,0.0001759],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget best_fit_65fx01_F55:=[[-368.53,-10.47,595.80],[0.999978,0.0012476,0.00669626,-0.000365287],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget drop_65fx01_F55:=[[-368.53,-10.48,595.81],[0.999978,0.00124335,0.00669765,-0.000364938],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget calib_gr1_f5X:=[[-349.59,-0.27,614.30],[0.999914,-0.00342919,-0.0109074,-0.00657979],[-1,0,1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];

CONST robtarget p10_F56:=[[137.72,932.15,2815.17],[0.526781,0.836136,-0.0299204,-0.149937],[0,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p20_F56:=[[24.74,394.51,2413.85],[0.369002,0.92285,0.00846925,-0.110053],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p30_F56:=[[-232.40,-39.22,1521.35],[0.15573,0.986164,0.00831562,-0.0561998],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p40_F56:=[[-349.62,-0.33,719.37],[4.40595E-06,-0.999999,9.11572E-07,-2.03794E-06],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p50_F56:=[[-371.66,-10.06,654.74],[0.00391026,-0.99972,-0.0076032,0.0220588],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p60_F56:=[[-371.65,-10.07,636.74],[0.00390963,-0.99972,-0.00760156,0.0220569],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p70_F56:=[[-371.63,-10.07,604.36],[0.00390629,-0.99972,-0.00758002,0.0220444],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p80_F56:=[[-735.96,189.06,415.49],[0.00387724,-0.999753,-0.00665088,0.020862],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p90_F56:=[[-730.93,190.44,394.18],[0.00492559,-0.999919,-0.00627623,0.00985617],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p100_F56:=[[-776.92,186.91,800.77],[0.00409854,-0.999902,-0.00667349,0.0115556],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p110_F56:=[[-707.65,185.37,1107.43],[0.00339159,-0.999887,-0.00699611,0.012862],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p120_F56:=[[-734.34,188.63,433.61],[0.0036885,-0.999775,-0.00667526,0.019771],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p130_F56:=[[-366.78,-8.48,807.97],[0.00353923,-0.999929,-0.00668629,0.0091029],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p140_F56:=[[-55.70,189.56,2142.44],[0.290021,0.952341,0.0152094,-0.0932879],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p150_F56:=[[11.84,305.45,2308.70],[0.335886,0.936306,0.017028,-0.101095],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p160_F56:=[[398.90,1716.94,3103.20],[0.712923,0.676403,-0.0298017,-0.182564],[0,0,2,4],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p170_F56:=[[615.79,2408.43,3208.52],[0.0131821,0.146547,-0.641976,-0.752473],[-1,0,2,4],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p180_F56:=[[1384.65,3407.53,2294.31],[0.130066,-0.196349,-0.772962,-0.589117],[-2,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p190_F56:=[[2129.19,3101.81,1023.05],[0.256303,-0.625461,-0.657334,-0.333196],[-2,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];

CONST robtarget p10_F55:=[[137.73,932.16,2815.17],[0.526783,0.836135,-0.0299224,-0.14994],[0,-1,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p20_F55:=[[24.74,394.51,2413.85],[0.369002,0.92285,0.00846925,-0.110053],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p30_F55:=[[-232.40,-39.22,1521.35],[0.15573,0.986164,0.00831562,-0.0561998],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p40_F55:=[[-349.62,-0.33,719.37],[4.40595E-06,-0.999999,9.11572E-07,-2.03794E-06],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p50_F55:=[[-373.70,-9.98,618.41],[0.00352273,-0.99994,-0.00632808,0.00811455],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p60_F55:=[[-371.15,-11.98,591.91],[0.00354148,-0.999857,-0.00840735,0.014182],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p70_F55:=[[-732.48,191.83,406.54],[0.00491295,-0.999848,-0.00600949,0.0155813],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p80_F55:=[[-730.93,190.44,394.18],[0.00492559,-0.999919,-0.00627623,0.00985617],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p90_F55:=[[-776.92,186.91,800.77],[0.00409854,-0.999902,-0.00667349,0.0115556],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p100_F55:=[[-707.65,185.37,1107.43],[0.00339159,-0.999887,-0.00699611,0.012862],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p110_F55:=[[-366.78,-8.48,807.97],[0.00353923,-0.999929,-0.00668629,0.0091029],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p120_F55:=[[-55.70,189.56,2142.44],[0.290021,0.952341,0.0152094,-0.0932879],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p130_F55:=[[11.84,305.45,2308.70],[0.335886,0.936306,0.017028,-0.101095],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p140_F55:=[[398.90,1716.94,3103.20],[0.712923,0.676403,-0.0298017,-0.182564],[0,0,2,4],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p150_F55:=[[615.79,2408.43,3208.52],[0.0131821,0.146547,-0.641976,-0.752473],[-1,0,2,4],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p160_F55:=[[1384.65,3407.53,2294.31],[0.130066,-0.196349,-0.772962,-0.589117],[-2,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];
CONST robtarget p170_F55:=[[2129.19,3101.80,1023.04],[0.256302,-0.625462,-0.657334,-0.333192],[-2,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]];


PROC f5x_01_65fx02_pick()
!***********************************************
!* Program : F56, F55 Pick bonnet from 65FX02  *
!* Location: 3FL5MBG16      65R02              *
!***********************************************
!*           Update Section                    *
!*          ================                   *
!* Date:     17/08/2013                        *
!* Engineer: Rafal Cieslinski / Staudinger     *
!* Changes:  create                            *
!*                                             *
!***********************************************

IF (OpMode()<>OP_AUTO) MoveAbsJ jpHome1,vmax,z50,t_Grp1\Wobj:=wobj_65fx02;

GrpPartChk low, GR01_B01PP\Part2:=GR01_B02PP\Part3:=GR01_B03PP\Part4:=GR01_B04PP;
GrpPartChk low, GR01_B05PP\Part2:=GR01_B06PP;
GrpChk Opn, Grp_11\Grp2:=Grp_12\Grp3:=Grp_13\Grp4:=Grp_14;

MoveJ_JobRequest 1, [[-320.29,93.81,1635.91],[0.0416104,0.997543,0.0416219,0.0379878],[-2,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200,t_Grp1\Wobj:=wobj_65fx02;

! Request collision zone 2 with robot 65R06
MoveJ_CollReq 2, [[-320.29,93.80,1635.91],[0.041611,0.997543,0.0416224,0.0379873],[-2,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj_65fx02;

MoveJ [[-349.635253,-0.316616,864.345554],[0.000002,1,-0.000002,0.000001],[-2,0,1,0],[9e+09,9e+09,9e+09,9e+09,9e+09,9e+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx02;
MoveL [[-376.60,-3.71,684.20],[0.00682102,-0.99992,-0.0100861,0.00326783],[-2,1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], v500, z200, t_Grp1\WObj:=wobj_65fx02;

MoveL pick_65fx02_f56, v100, fine, t_Grp1\WObj:=wobj_65fx02;
 
PLC_Release "PickUp Bonet F56_RH from 65fx02"\Set_:=PLC_do_User_01\Wait_:=PLC_di_User_01;

TEST n_Type_Mem
   CASE 1,3,5,7:
     !F55/F56 Cooper;
     GrpPartChk low, GR01_B04PP;
     GrpPartChk high, GR01_B01PP\Part2:=GR01_B02PP\Part3:=GR01_B03PP;
  
	 
   CASE 2,4,6,8:
     ! F55/F56 Cooper S;
     GrpPartChk low, GR01_B03PP;
     GrpPartChk high, GR01_B01PP\Part2:=GR01_B02PP;
 

   DEFAULT:
     WHILE TRUE DO
       Stop;
       !*********************************
       !*   Error: Incorrect car type   *
       !*********************************
     ENDWHILE
ENDTEST

GrpSet Cls, Grp_12;
GrpSet Cls, Grp_11\PartLoad:=ld_Bonnet_f56;

MoveL [[-374.27,-4.61,649.31],[0.00616305,-0.999934,-0.0086243,0.00438816],[-2,1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], v50, fine, t_Grp1\WObj:=wobj_65fx02;

TEST n_Type_Mem
   CASE 1,3,5,7:
     ! F55/F56 cooper;
     GrpPartChk low, GR01_B04PP;
     GrpPartChk high, GR01_B01PP\Part2:=GR01_B02PP\Part3:=GR01_B03PP;

   CASE 2,4,6,8:
     ! F55/F56 cooper S;
     GrpPartChk low, GR01_B03PP;
     GrpPartChk high, GR01_B01PP\Part2:=GR01_B02PP;

   DEFAULT:
      WHILE TRUE DO
        Stop;
        !*********************************
        !*   Error: Incorrect car type   *
        !*********************************
      ENDWHILE
ENDTEST

MoveJ [[-256.838903,5.71553,773.410358],[0.003638,0.999804,0.009932,0.016759],[-2,1,1,0],[9e+09,9e+09,9e+09,9e+09,9e+09,9e+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx02;
MoveJ [[472.33,107.64,1609.49],[0.117282,0.985749,0.109507,0.0504991],[-2,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx02;

! Clear collision zone 2 with robot 65R06
MoveJ_CollClr 2, [[688.68,228.97,1969.52],[0.183289,0.961072,0.165187,0.124327],[-2,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj_65fx02;
MoveJ [[1264.03,1399.98,2797.32],[0.247007,0.685386,0.657547,0.192003],[-2,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx02;

MoveJ_JobFinished 1,[[594.587536,1929.718264,3486.109897],[0.014707,0.41434,0.745412,0.522061],[-1,0,2,4],[9e+09,9e+09,9e+09,9e+09,9e+09,9e+09]] , vmax, z200,t_Grp1\Wobj:=wobj_65fx02;
MoveJ [[16.26,1880.65,4062.09],[0.532564,0.187101,-0.365621,-0.74006],[0,0,2,4],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx02;

MoveAbsJ jpHome2,vmax,z50,t_Grp1\Wobj:=wobj_65fx02;

RETURN;
ENDPROC


PROC f56_02_65fx01_fit()
!***********************************************
!* Program : F56 BestFit bonnet to body        *
!* Location: 3FL5MBG16      65R02              *
!***********************************************
!*           Update Section                    *
!*          ================                   *
!* Date:     17/08/2013                        *
!* Engineer: Rafal Cieslinski / Staudinger     *
!* Changes:  create                            *
!*                                             *
!***********************************************

IF (OpMode()<>OP_AUTO) MoveAbsJ jpHome2,vmax,z50,t_Grp1\Wobj:=wobj_65fx01;

TEST n_Type_Mem
   CASE 1,3:
     ! F56 cooper;
     GrpPartChk low, GR01_B04PP\Part2:=GR01_B05PP\Part3:=GR01_B06PP;
     GrpPartChk high, GR01_B01PP\Part2:=GR01_B02PP\Part3:=GR01_B03PP; 

   CASE 2,4:
     ! F56 cooper S;
     GrpPartChk low, GR01_B03PP\Part2:=GR01_B05PP\Part3:=GR01_B06PP;
     GrpPartChk high, GR01_B01PP\Part2:=GR01_B02PP;	 

   DEFAULT:
      WHILE TRUE DO
        Stop;
        !*********************************
        !*   Error: Incorrect car type   *
        !*********************************
      ENDWHILE
ENDTEST

GrpChk Cls, Grp_11\Grp2:=Grp_12;
GrpChk Opn, Grp_13;
	 
!******************************************
!*  Request for Pounce Job in Home2 Pos.  *
!******************************************
MoveJ_JobRequest 2, p10_F56,vmax,fine,t_Grp1\Wobj:=wobj_65fx01;

! Request collision zone 11 with robot 65R01
! Request collision zone 12 with robot 65R03
MoveJ_CollReq 11\Coll_B:=12, p10_F56, vmax, fine, t_Grp1\Wobj:=wobj_65fx01;

! Request collision zone 3 with robot 65R04
MoveJ_CollReq 3, p20_F56,vmax,z200,t_Grp1\Wobj:=wobj_65fx01;

! Request collision zone 4 with robot 65R04
MoveJ_CollReq 4, p30_F56, vmax, z50, t_Grp1\WObj:=wobj_65fx01;
!*******************************************
!*  Request for Drop Job 3 in Pounce pos.  *
!*******************************************
MoveJ_JobRequest 3, p40_F56, vmax, z200, t_Grp1\WObj:=wobj_65fx01;

!Best Fit Initialisation
BF_initialize t_BCF_F55,wobj_65fx01,wobj_65fx01_best_fit;
!PickQuality
BF_INOS 3, 3, n_Inos_Type, 2, 1, 1\b_PAR_UPD_AVG:=FALSE;

MoveL p50_F56, vmax, z200, t_Grp1\WObj:=wobj_65fx01;
MoveL p60_F56, v200, z200, t_Grp1\WObj:=wobj_65fx01;

AccSet 30,30;

MoveL p70_F56, v200, z200, t_Grp1\WObj:=wobj_65fx01;

! BestFit measurementposition - 10mm above drop_65fx01_F56 position;
MoveL best_fit_65fx01_F56, v200, fine, t_BCF_F55\WObj:=wobj_65fx01;
!Delay to remove shaking of bonnet
WaitUntil\InPos, TRUE;
WaitTime 0.5;

!********  Preposition  *********
! Request robot max movement threshold from PC for process type:1
BF_INOS 1, 3, n_Inos_Type, 4, 1, 1\b_PAR_UPD_AVG:=FALSE;
! Best-fit correction
BF_INOS 2, 3, n_Inos_Type, 4, 3, 1\b_PAR_UPD_AVG:=TRUE;
wobj_65fx01_best_fit:=wobj_inosWobj;  
!*******************************************

!**********  Temp for teaching  ************ 
!wobj_65fx01_best_fit:=wobj_65fx01;
!wobj_inosWobj:=wobj_65fx01;
!MoveL Offs(drop_65fx01_F56,0,0,10), vmax, z200, t_BCF_F55\WObj:=wobj_65fx01_best_fit;
!*******************************************

! Clear collision zone 3 with robot 65R04
! Clear collision zone 4 with robot 65R04
! BestFit measurementposition
MoveL_CollClr 3\Coll_B:=4, drop_65fx01_F56, v200, fine, t_BCF_F55\Wobj:=wobj_65fx01_best_fit;

WaitUntil\InPos, TRUE;

!********  Endposition  *********
! Request robot max movement threshold from PC for process type:1
BF_INOS 1, 3, n_Inos_Type, 5, 1, 1\b_PAR_UPD_AVG:=FALSE;
! Best-fit correction
BF_INOS 2, 3, n_Inos_Type, 5, 3, 1\b_PAR_UPD_AVG:=TRUE;
!*******************************************

!********************************************************************
!*   Waiting for PLC acknowledge Drop/Bolt Bonet F56_RH on 65fx01   *
!********************************************************************
PLC_Release "Drop/Bolt Bonet F56_RH on 65fx01"\Set_:=PLC_do_User_03\Wait_:=PLC_di_User_03;

!temp measurement after screw
!BF_INOS 3, 3, n_Inos_Type, 6, 1, 1\b_PAR_UPD_AVG:=FALSE;

GrpSet Cls, Grp_13;
GrpSet Opn, Grp_11\Grp2:=Grp_12\Grp3:=Grp_14\PartLoad:=load0;

!temp measurement after drop
!BF_INOS 3, 3, n_Inos_Type, 7, 1, 1\b_PAR_UPD_AVG:=FALSE;

MoveL p80_F56, v200, fine, t_Grp1_Roll\WObj:=wobj_65fx01;

!*****  Final Quality BF Measurement  ******
IF PLC_di_BF_Bolt_Error = 1  THEN     
   BF_INOS 3, 3, n_Inos_Type, 10, 1, 1\b_PAR_UPD_AVG:=FALSE;
ELSEIF PLC_di_BF_Mean = 1  THEN 
   BF_INOS 3, 3, n_Inos_Type, 9, 1, 1\b_PAR_UPD_AVG:=FALSE;
ELSE
   BF_INOS 3, 3, n_Inos_Type, 8, 1, 1\b_PAR_UPD_AVG:=FALSE;  
ENDIF

AccSet 100, 100;

MoveL p90_F56, vmax, z100, t_Grp1_Roll\WObj:=wobj_65fx01_best_fit;
MoveL p100_F56,vmax,z100,t_Grp1_Roll\Wobj:=wobj_65fx01_best_fit;
MoveL p110_F56, v5000, z100, t_Grp1_Roll\WObj:=wobj_65fx01_best_fit;

!********************************************************************
!*   Waiting for PLC acknowledge Open/Close Bonet F56_RH on 65fx01  *
!********************************************************************
PLC_Release "Open/Close Bonet F56_RH on 65fx01"\Set_:=PLC_do_User_04\Wait_:=PLC_di_User_04\InPos;

! Request collision zone 5 with robot 65R04
MoveJ_CollReq 5, p110_F56, vmax, fine, t_Grp1_Roll\WObj:=wobj_65fx01_best_fit;

MoveL p100_F56,vmax,z100,t_Grp1_Roll\Wobj:=wobj_65fx01_best_fit;
MoveL p90_F56, v5000, z100, t_Grp1_Roll\WObj:=wobj_65fx01_best_fit;

GrpSet Opn, Grp_13;

MoveL best_fit_65fx01_F56, v500, fine, t_BCF_F55\WObj:=wobj_65fx01_best_fit;
MoveL p120_F56, v5000, z100, t_Grp1_Roll\WObj:=wobj_65fx01_best_fit;

GrpPartChk low, GR01_B01PP\Part2:=GR01_B02PP;

MoveL_JobFinished 3, p130_F56,vmax,z200,t_Grp1\Wobj:=wobj_65fx01;

MoveJ_JobFinished 2, p140_F56,vmax,z200,t_Grp1\Wobj:=wobj_65fx01;

! Clear collision zone 5 with robot 65R04
MoveJ_CollClr 5, p150_F56, vmax, z200, t_Grp1\WObj:=wobj_65fx01;
MoveJ p160_F56,vmax,z200,t_Grp1\Wobj:=wobj_65fx01;
MoveJ p170_F56,vmax,z200,t_Grp1\Wobj:=wobj_65fx01;
MoveJ p180_F56,vmax,z200,t_Grp1\Wobj:=wobj_65fx01;

! Clear collision zone 11 with robot 65R01
! Clear collision zone 12 with robot 65R03
MoveJ_CollClr 11\Coll_B:=12, p190_F56, vmax, z100, t_Grp1\Wobj:=wobj_65fx01;

MoveAbsJ jpHome1,vmax,z50,t_Grp1\Wobj:=wobj_65fx01;

!Disconnect from PC
BF_IOEXIT;

RETURN;
ENDPROC ! f56_02_65fx01_fit()


PROC f56_02_65fx01_allignment_check()
!***********************************************
!* Program : F56 allignment check              *
!* Location: 3FL5MBG16      65R02              *
!***********************************************
!*           Update Section                    *
!*          ================                   *
!* Date:     17/08/2013                        *
!* Engineer: Rafal Cieslinski / Staudinger     *
!* Changes:  create                            *
!*                                             *
!***********************************************

! Reset inos workobject
wobj_inosWobj:=wobj_65fx01;
wobj_65fx01_best_fit:=wobj_inosWobj;    

IF (OpMode()<>OP_AUTO) MoveAbsJ jpHome2,vmax,z50,t_Grp1\Wobj:=wobj_65fx01;

TEST n_Type_Mem
   CASE 1,3:
     ! F56 cooper;
     GrpPartChk low, GR01_B04PP\Part2:=GR01_B05PP\Part3:=GR01_B06PP;
     GrpPartChk high, GR01_B01PP\Part2:=GR01_B02PP\Part3:=GR01_B03PP; 

   CASE 2,4:
     ! F56 cooper S;
     GrpPartChk low, GR01_B03PP\Part2:=GR01_B05PP\Part3:=GR01_B06PP;
     GrpPartChk high, GR01_B01PP\Part2:=GR01_B02PP;	 

   DEFAULT:
      WHILE TRUE DO
        Stop;
        !*********************************
        !*   Error: Incorrect car type   *
        !*********************************
      ENDWHILE
ENDTEST

GrpChk Cls, Grp_11\Grp2:=Grp_12;
GrpChk Opn, Grp_13;


MoveJ_JobRequest 4, p10_F56,vmax,fine,t_Grp1\Wobj:=wobj_65fx01;

! Request collision zone 11 with robot 65R01
! Request collision zone 12 with robot 65R03
MoveJ_CollReq 11\Coll_B:=12, p10_F56, vmax, fine, t_Grp1\Wobj:=wobj_65fx01;

! Request collision zone 3 with robot 65R04
MoveJ_CollReq 3, p20_F56,vmax,z200,t_Grp1\Wobj:=wobj_65fx01;

! Request collision zone 4 with robot 65R04
MoveJ_CollReq 4, p30_F56, vmax, z50, t_Grp1\WObj:=wobj_65fx01;
MoveJ p40_F56, vmax, z200, t_Grp1\WObj:=wobj_65fx01;
MoveL p50_F56, vmax, z200, t_Grp1\WObj:=wobj_65fx01;
MoveL p60_F56, v200, z200, t_Grp1\WObj:=wobj_65fx01;
MoveL p70_F56, v200, z200, t_Grp1\WObj:=wobj_65fx01;

! BestFit measurementposition - 10mm above drop_65fx01_F56 position;

MoveL best_fit_65fx01_F56, v200, fine, t_BCF_F55\WObj:=wobj_65fx01;
!Delay to remove shaking of bonnet
WaitUntil\InPos, TRUE;
WaitTime 0.5;

!**********  Temp for teaching  ************ 
!wobj_65fx01_best_fit:=wobj_65fx01;
!wobj_inosWobj:=wobj_65fx01;
!MoveL Offs(drop_65fx01_F56,0,0,10), vmax, z200, t_BCF_F55\WObj:=wobj_65fx01_best_fit;
!*******************************************

MoveL drop_65fx01_F56, v200, fine, t_BCF_F55\Wobj:=wobj_65fx01_best_fit;

PLC_Release "Drop/Bolt Bonnet on 65fx01"\Set_:=PLC_do_User_06\Wait_:=PLC_di_User_06;

MoveL drop_65fx01_F56, v200, fine, t_BCF_F55\Wobj:=wobj_65fx01_best_fit;

MoveL best_fit_65fx01_F56, v200, fine, t_BCF_F55\WObj:=wobj_65fx01;
MoveL p70_F56, v200, z200, t_Grp1\WObj:=wobj_65fx01;
MoveL p60_F56, v200, z200, t_Grp1\WObj:=wobj_65fx01;
MoveL p50_F56, vmax, z200, t_Grp1\WObj:=wobj_65fx01;
MoveJ p40_F56, vmax, z200, t_Grp1\WObj:=wobj_65fx01;

! Clear collision zone 4 with robot 65R04
MoveJ_CollClr 4, p30_F56, vmax, z50, t_Grp1\WObj:=wobj_65fx01;

! Clear collision zone 3 with robot 65R04
MoveJ_CollClr 3, p20_F56,vmax,z200,t_Grp1\Wobj:=wobj_65fx01;

! Clear collision zone 11 with robot 65R01
! Clear collision zone 12 with robot 65R03
MoveJ_CollClr 11\Coll_B:=12, p10_F56, vmax, fine, t_Grp1\Wobj:=wobj_65fx01;
MoveJ_JobFinished 4, p10_F56,vmax,fine,t_Grp1\Wobj:=wobj_65fx01;

MoveAbsJ jpHome2,vmax,z50,t_Grp1\Wobj:=wobj_65fx01;

RETURN;
ENDPROC ! f56_02_65fx01_allignment_check()


PROC f55_02_65fx01_fit()
!***********************************************
!* Program : F55 BestFit bonnet to body        *
!* Location: 3FL5MBG16      65R02              *
!***********************************************
!*           Update Section                    *
!*          ================                   *
!* Date:     17/08/2013                        *
!* Engineer: Rafal Cieslinski / Staudinger     *
!* Changes:  create                            *
!*                                             *
!***********************************************

IF (OpMode()<>OP_AUTO) MoveAbsJ jpHome2,vmax,z50,t_Grp1\Wobj:=wobj_65fx01;

TEST n_Type_Mem
   CASE 5,7:
     ! F55 cooper;
     GrpPartChk low, GR01_B04PP\Part2:=GR01_B05PP\Part3:=GR01_B06PP;
     GrpPartChk high, GR01_B01PP\Part2:=GR01_B02PP\Part3:=GR01_B03PP;	 

   CASE 6,8:
     ! F55 cooper S;
     GrpPartChk low, GR01_B03PP\Part2:=GR01_B05PP\Part3:=GR01_B06PP;
     GrpPartChk high, GR01_B01PP\Part2:=GR01_B02PP;	 

   DEFAULT:
      WHILE TRUE DO
        Stop;
        !*********************************
        !*   Error: Incorrect car type   *
        !*********************************
      ENDWHILE
ENDTEST

GrpChk Cls, Grp_11\Grp2:=Grp_12;
GrpChk Opn, Grp_13;

!******************************************
!*  Request for Pounce Job in Home2 Pos.  *
!******************************************
MoveJ_JobRequest 2, p10_F55,vmax,fine,t_Grp1\Wobj:=wobj_65fx01;
! Request collision zone 11 with robot 65R01
! Request collision zone 12 with robot 65R03
MoveJ_CollReq 11\Coll_B:=12, p10_F55, vmax, fine, t_Grp1\Wobj:=wobj_65fx01;

! Request collision zone 3 with robot 65R04
MoveJ_CollReq 3, p20_F55,vmax,z200,t_Grp1\Wobj:=wobj_65fx01;

! Request collision zone 4 with robot 65R04
MoveJ_CollReq 4, p30_F55, vmax, z50, t_Grp1\WObj:=wobj_65fx01;
!*******************************************
!*  Request for Drop Job 3 in Pounce pos.  *
!*******************************************
MoveJ_JobRequest 3, p40_F55, vmax, z200, t_Grp1\WObj:=wobj_65fx01;

!Best Fit Initialisation
BF_initialize t_BCF_F55,wobj_65fx01,wobj_65fx01_best_fit;
!PickQuality
BF_INOS 3, 3, n_Inos_Type, 2, 1, 1\b_PAR_UPD_AVG:=FALSE;

MoveL p50_F55, vmax, z200, t_Grp1\WObj:=wobj_65fx01;
MoveL p60_F55, v200, z200, t_Grp1\WObj:=wobj_65fx01;

! BestFit preposition;
MoveL best_fit_65fx01_F55, v200, fine, t_BCF_F55\WObj:=wobj_65fx01;
! Wait times to remove bonnet shaking during measurement
WaitUntil\InPos, TRUE;
WaitTime 0.5;

!********  Preposition  *********
! Request robot max movement threshold from PC for process type:1
BF_INOS 1, 3, n_Inos_Type, 4, 1, 1\b_PAR_UPD_AVG:=FALSE;
! Best-fit correction
BF_INOS 2, 3, n_Inos_Type, 4, 3, 1\b_PAR_UPD_AVG:=TRUE;
wobj_65fx01_best_fit:=wobj_inosWobj;  
!*******************************************	 

!**********  Temp for teaching  ************ 
!wobj_65fx01_best_fit:=wobj_65fx01;
!wobj_inosWobj:=wobj_65fx01;
!MoveL Offs(drop_65fx01_F55,0,0,10), vmax, z200, t_BCF_F55\WObj:=wobj_65fx01_best_fit;
!*******************************************

! Clear collision zone 3 with robot 65R04
! Clear collision zone 4 with robot 65R04
MoveL_CollClr 3\Coll_B:=4, drop_65fx01_F55, v200, fine, t_BCF_F55\Wobj:=wobj_65fx01_best_fit;
WaitUntil\InPos, TRUE;

!********  Endposition  *********
! Request robot max movement threshold from PC for process type:1
BF_INOS 1, 3, n_Inos_Type, 5, 1, 1\b_PAR_UPD_AVG:=FALSE;
! Best-fit correction
BF_INOS 2, 3, n_Inos_Type, 5, 3, 1\b_PAR_UPD_AVG:=TRUE;
!*******************************************

!********************************************************************
!*   Waiting for PLC acknowledge Drop/Bolt Bonet F56_RH on 65fx01   *
!********************************************************************
PLC_Release "Drop/Bolt Bonet F5X_RH on 65fx01"\Set_:=PLC_do_User_03\Wait_:=PLC_di_User_03;

!temp measurement after screw
!BF_INOS 3, 3, n_Inos_Type, 6, 1, 1\b_PAR_UPD_AVG:=FALSE;

GrpSet Cls, Grp_13;
GrpSet Opn, Grp_11\Grp2:=Grp_12\Grp3:=Grp_14\PartLoad:=load0;

!temp measurement after drop
!BF_INOS 3, 3, n_Inos_Type, 7, 1, 1\b_PAR_UPD_AVG:=FALSE;

MoveL p70_F55, v200, fine, t_Grp1_Roll\WObj:=wobj_65fx01;

!*****  Final Quality BF Measurement  ******
IF PLC_di_BF_Bolt_Error = 1  THEN     
   BF_INOS 3, 3, n_Inos_Type, 10, 1, 1\b_PAR_UPD_AVG:=FALSE;
ELSEIF PLC_di_BF_Mean = 1  THEN 
   BF_INOS 3, 3, n_Inos_Type, 9, 1, 1\b_PAR_UPD_AVG:=FALSE;
ELSE
   BF_INOS 3, 3, n_Inos_Type, 8, 1, 1\b_PAR_UPD_AVG:=FALSE;  
ENDIF

MoveL p80_F55, vmax, z100, t_Grp1_Roll\WObj:=wobj_65fx01_best_fit;
MoveL p90_F55,vmax,z100,t_Grp1_Roll\Wobj:=wobj_65fx01_best_fit;
MoveL p100_F55, v5000, z100, t_Grp1_Roll\WObj:=wobj_65fx01_best_fit;

!********************************************************************
!*   Waiting for PLC acknowledge Open/Close Bonet F56_RH on 65fx01  *
!********************************************************************
PLC_Release "Open/Close Bonet F56_RH on 65fx01"\Set_:=PLC_do_User_04\Wait_:=PLC_di_User_04\InPos;

! Request collision zone 5 with robot 65R04
MoveJ_CollReq 5, p100_F55, vmax, fine, t_Grp1_Roll\WObj:=wobj_65fx01_best_fit;

MoveL p90_F55,vmax,z100,t_Grp1_Roll\Wobj:=wobj_65fx01_best_fit;
MoveL p80_F55, v5000, z100, t_Grp1_Roll\WObj:=wobj_65fx01_best_fit;

GrpSet Opn, Grp_13;

MoveL best_fit_65fx01_F55, v200, fine, t_BCF_F55\WObj:=wobj_65fx01_best_fit;

MoveL_JobFinished 3, p110_F55,vmax,z200,t_Grp1\Wobj:=wobj_65fx01;

GrpPartChk low, GR01_B01PP\Part2:=GR01_B02PP;

MoveJ_JobFinished 2, p120_F55,vmax,z200,t_Grp1\Wobj:=wobj_65fx01;

! Clear collision zone 5 with robot 65R04
MoveJ_CollClr 5, p130_F55, vmax, z200, t_Grp1\WObj:=wobj_65fx01;

MoveJ p140_F55,vmax,z200,t_Grp1\Wobj:=wobj_65fx01;
MoveJ p150_F55,vmax,z200,t_Grp1\Wobj:=wobj_65fx01;
MoveJ p160_F55,vmax,z200,t_Grp1\Wobj:=wobj_65fx01;
! Clear collision zone 11 with robot 65R01
! Clear collision zone 12 with robot 65R03
MoveJ_CollClr 11\Coll_B:=12, p170_F55, vmax, z100, t_Grp1\Wobj:=wobj_65fx01;

MoveAbsJ jpHome1,vmax,z50,t_Grp1\Wobj:=wobj_65fx01;

!Disconnect from PC
BF_IOEXIT;

RETURN;
ENDPROC ! f55_02_65fx01_fit()


PROC f55_02_65fx01_allignment_check()
!***********************************************
!* Program : F55 allignment check              *
!* Location: 3FL5MBG16      65R02              *
!***********************************************
!*           Update Section                    *
!*          ================                   *
!* Date:     17/08/2013                        *
!* Engineer: Rafal Cieslinski / Staudinger     *
!* Changes:  create                            *
!*                                             *
!***********************************************
  
! Reset inos workobject
wobj_inosWobj:=wobj_65fx01;
wobj_65fx01_best_fit:=wobj_inosWobj;  
  

IF (OpMode()<>OP_AUTO) MoveAbsJ jpHome2,vmax,z50,t_Grp1\Wobj:=wobj_65fx01;

TEST n_Type_Mem
   CASE 5,7:
     ! F55 cooper;
     GrpPartChk low, GR01_B04PP\Part2:=GR01_B05PP\Part3:=GR01_B06PP;
     GrpPartChk high, GR01_B01PP\Part2:=GR01_B02PP\Part3:=GR01_B03PP;	 

   CASE 6,8:
     ! F55 cooper S;
     GrpPartChk low, GR01_B03PP\Part2:=GR01_B05PP\Part3:=GR01_B06PP;
     GrpPartChk high, GR01_B01PP\Part2:=GR01_B02PP;	 

   DEFAULT:
      WHILE TRUE DO
        Stop;
        !*********************************
        !*   Error: Incorrect car type   *
        !*********************************
      ENDWHILE
ENDTEST

GrpChk Cls, Grp_11\Grp2:=Grp_12;
GrpChk Opn, Grp_13;

MoveJ_JobRequest 4, p10_F55,vmax,fine,t_Grp1\Wobj:=wobj_65fx01;

! Request collision zone 11 with robot 65R01
! Request collision zone 12 with robot 65R03
MoveJ_CollReq 11\Coll_B:=12, p10_F55, vmax, fine, t_Grp1\Wobj:=wobj_65fx01;

! Request collision zone 3 with robot 65R04
MoveJ_CollReq 3, p20_F55,vmax,z200,t_Grp1\Wobj:=wobj_65fx01;

! Request collision zone 4 with robot 65R04
MoveJ_CollReq 4, p30_F55, vmax, z50, t_Grp1\WObj:=wobj_65fx01;
MoveJ p40_F55, vmax, z200, t_Grp1\WObj:=wobj_65fx01;
MoveL p50_F55, vmax, z200, t_Grp1\WObj:=wobj_65fx01;
MoveL p60_F55, v200, z200, t_Grp1\WObj:=wobj_65fx01;

! BestFit measurementposition - 10mm above drop_65fx01_F55 position;
MoveL best_fit_65fx01_F55, v200, fine, t_BCF_F55\WObj:=wobj_65fx01;
! Wait times to remove bonnet shaking during measurement
WaitUntil\InPos, TRUE;
WaitTime 0.5;

!**********  Temp for teaching  ************ 
!wobj_65fx01_best_fit:=wobj_65fx01;
!wobj_inosWobj:=wobj_65fx01;
!MoveL Offs(drop_65fx01_F55,0,0,10), vmax, z200, t_BCF_F55\WObj:=wobj_65fx01_best_fit;
!*******************************************

MoveL drop_65fx01_F55, v200, fine, t_BCF_F55\Wobj:=wobj_65fx01_best_fit;

PLC_Release "Drop/Bolt Bonnet on 65fx01"\Set_:=PLC_do_User_06\Wait_:=PLC_di_User_06;

MoveL drop_65fx01_F55, v200, fine, t_BCF_F55\Wobj:=wobj_65fx01_best_fit;

MoveL best_fit_65fx01_F55, v200, fine, t_BCF_F55\WObj:=wobj_65fx01;
MoveL p60_F55, v200, z200, t_Grp1\WObj:=wobj_65fx01;
MoveL p50_F55, vmax, z200, t_Grp1\WObj:=wobj_65fx01;
MoveJ p40_F55, vmax, z200, t_Grp1\WObj:=wobj_65fx01;

! Clear collision zone 4 with robot 65R04
MoveJ_CollClr 4, p30_F55, vmax, z50, t_Grp1\WObj:=wobj_65fx01;

! Clear collision zone 3 with robot 65R04
MoveJ_CollClr 3, p20_F55,vmax,z200,t_Grp1\Wobj:=wobj_65fx01;

! Clear collision zone 11 with robot 65R01
! Clear collision zone 12 with robot 65R03
MoveJ_CollClr 11\Coll_B:=12, p10_F55, vmax, fine, t_Grp1\Wobj:=wobj_65fx01;
MoveJ_JobFinished 4, p10_F55,vmax,fine,t_Grp1\Wobj:=wobj_65fx01;

MoveAbsJ jpHome2,vmax,z50,t_Grp1\Wobj:=wobj_65fx01;

RETURN;
ENDPROC ! (f55_02_65fx01_allignment_check)


PROC Calibration_Stationary_Sensor()
!***********************************************
!* Program : F5X BestFit sensor calibration    *
!* Location: 3FL5MBG16      65R02              *
!***********************************************
!*           Update Section                    *
!*          ================                   *
!* Date:     17/08/2013                        *
!* Engineer: Rafal Cieslinski / Staudinger     *
!* Changes:  create                            *
!*                                             *
!***********************************************
CheckManualTestMode;

WaitDO SYS_do_Home_1,high;
!**************************************
!*   Wait for robot to be in Home 1   *
!**************************************

MoveAbsJ jpHome1,vmax,fine,t_Grp1\Wobj:=wobj_65fx01;

GrpPartChk low, GR01_B01PP\Part2:=GR01_B02PP\Part3:=GR01_B03PP\Part4:=GR01_B04PP;
GrpPartChk low, GR01_B05PP\Part2:=GR01_B06PP;
GrpSet Cls, Grp_12\Grp2:=Grp_13\PartLoad:=load0;

! Request collision zone 3 with robot 65R04
MoveJ_CollReq 3, [[1384.66,3407.53,2294.30],[0.130067,-0.196351,-0.772962,-0.589115],[-2,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj_65fx01;
MoveJ [[446.331895,2312.008051,3128.542916],[0.262005,0.321396,-0.55667,-0.719845],[-1,0,2,4],[9e+09,9e+09,9e+09,9e+09,9e+09,9e+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx01;
MoveJ [[410.38,1813.20,3128.55],[0.73994,0.640343,-0.0560242,-0.198267],[0,-1,2,4],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx01;
MoveJ [[32.63,695.54,2857.03],[0.529624,0.831325,-0.0226629,-0.166978],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx01;
MoveJ [[-194.176132,-100.171124,1753.845836],[0.250685,0.962873,0.038207,-0.092593],[0,0,1,0],[9e+09,9e+09,9e+09,9e+09,9e+09,9e+09]], vmax, z200, t_Grp1\WObj:=wobj_65fx01;
MoveJ [[-343.96,-45.38,1046.30],[0.0419552,0.998739,0.0124158,-0.0245996],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx01;
MoveL [[-367.51,-9.83,894.61],[0.00349528,-0.999937,-0.00669974,0.0082],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj_65fx01;


WHILE (GR01_AF1_di_28 = 0 OR GR01_AF1_di_29 = 0) DO
  UIMsgBox "      *************************************"\MsgLine2:="      *  BestFit gripper must be mounted  *"\MsgLine3:="      *************************************";
  TPErase;    
ENDWHILE

GrpPartChk high, GR01_B05PP\Part2:=GR01_B06PP;

! best-fit measurementposition 10mm above insert-position;
MoveL [[-367.02,-9.84,596.83],[0.999996,0.000111601,-0.00280924,0.00170921],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_BCF_F55\WObj:=wobj_65fx01;
!**************************************

!Best Fit Initialisation
BF_initialize t_BCF_F55,wobj_65fx01,wobj_65fx01_best_fit;
!Reference measure for stationary sensors
BF_INOS 3, 1, 2, 1, 1, 1\b_PAR_UPD_AVG:=FALSE;


WHILE (GR01_AF1_di_28 = 1 OR GR01_AF1_di_29 = 1) DO
  UIMsgBox "      *************************************"\MsgLine2:="      *  BestFit gripper must be remove   *"\MsgLine3:="      *************************************";
  TPErase;    
ENDWHILE
GrpPartChk low, GR01_B05PP\Part2:=GR01_B06PP;

MoveL [[-367.51,-9.83,894.61],[0.00349528,-0.999937,-0.00669974,0.0082],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj_65fx01;
MoveJ [[-343.96,-45.38,1046.30],[0.0419552,0.998739,0.0124158,-0.0245996],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx01;
MoveJ [[-194.176132,-100.171124,1753.845836],[0.250685,0.962873,0.038207,-0.092593],[0,0,1,0],[9e+09,9e+09,9e+09,9e+09,9e+09,9e+09]], vmax, z200, t_Grp1\WObj:=wobj_65fx01;
MoveJ [[32.63,695.54,2857.03],[0.529624,0.831325,-0.0226629,-0.166978],[0,-1,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx01;
MoveJ [[410.38,1813.20,3128.55],[0.73994,0.640343,-0.0560242,-0.198267],[0,-1,2,4],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx01;
MoveJ [[446.331895,2312.008051,3128.542916],[0.262005,0.321396,-0.55667,-0.719845],[-1,0,2,4],[9e+09,9e+09,9e+09,9e+09,9e+09,9e+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx01;

! Clear collision zone 3 with robot 65R04
MoveJ_CollClr 3, [[1384.66,3407.53,2294.31],[0.130065,-0.196349,-0.772962,-0.589116],[-2,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj_65fx01;

GrpPartChk low, GR01_B01PP\Part2:=GR01_B02PP\Part3:=GR01_B03PP\Part4:=GR01_B04PP;
GrpPartChk low, GR01_B05PP\Part2:=GR01_B06PP;
GrpSet Opn, Grp_11\Grp2:=Grp_12\Grp3:=Grp_13\Grp4:=Grp_14\noGripChk;

MoveAbsJ jpHome1,vmax,fine,t_Grp1\Wobj:=wobj_65fx01;

!Disonnect Best Fit PC
BF_IOEXIT;

RETURN;
ENDPROC !(Calibration_Stationary_Sensor)


PROC Calibration_Grp()
!***********************************************
!* Program : F56 Calibration gripper1          *
!* Location: 3FL5MBG16      65R02              *
!***********************************************
!*           Update Section                    *
!*          ================                   *
!* Date:     17/08/2013                        *
!* Engineer: Rafal Cieslinski / Staudinger     *
!* Changes:  create                            *
!*                                             *
!***********************************************

MoveAbsJ jpHome1,vmax,fine,t_Grp1\Wobj:=wobj_calibration;

GrpPartChk low, GR01_B01PP\Part2:=GR01_B02PP\Part3:=GR01_B03PP\Part4:=GR01_B04PP;
GrpPartChk low, GR01_B05PP\Part2:=GR01_B06PP;
GrpSet Cls, Grp_12\Grp2:=Grp_13\PartLoad:=load0;

MoveJ_JobRequest 15, [[-149.42,2021.18,1928.02],[0.0379853,0.0416284,-0.997542,-0.041607],[-2,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax,fine, t_Grp1\Wobj:=wobj_calibration;

! Request collision zone 1 with robot 65R04
MoveJ_CollReq 1, [[-149.43,2021.19,1928.03],[0.0379876,0.0416296,-0.997542,-0.0416094],[-2,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj_calibration;

MoveJ [[-1092.41,1400.04,2540.36],[0.0967793,0.52186,-0.769782,-0.354583],[-2,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj_calibration;
MoveJ [[-1426.81,623.54,2221.74],[0.142386,0.74205,-0.536828,-0.375368],[-1,0,1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj_calibration;
MoveJ [[-753.38,206.73,1073.19],[0.0160497,-0.934143,0.333552,0.125939],[-1,0,1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj_calibration;
MoveJ [[-349.629384,-0.296483,814.27519],[0,1,0,0.000001],[-1,0,1,1],[9e+09,9e+09,9e+09,9e+09,9e+09,9e+09]],vmax,z200,t_Grp1\Wobj:=wobj_calibration;

MoveL calib_gr1_f5X, v200, fine, t_BCF_F55\WObj:=wobj_calibration;

PLC_Release "calibration release"\Set_:=PLC_do_User_15\Wait_:=PLC_di_User_15;
WaitTime 4;

!Best Fit Initialisation
BF_initialize t_BCF_F55,wobj_calibration,wobj_65fx01_best_fit;
!Reference measure
BF_INOS 3, 1, 1, 1, 1, 1\b_PAR_UPD_AVG:=FALSE;

MoveL [[-349.629384,-0.296483,814.27519],[0,1,0,0.000001],[-1,0,1,1],[9e+09,9e+09,9e+09,9e+09,9e+09,9e+09]],v200,z200,t_Grp1\Wobj:=wobj_calibration;
MoveJ [[-753.38,206.73,1073.19],[0.0160497,-0.934143,0.333552,0.125939],[-1,0,1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_calibration;
MoveJ [[-1426.81,623.54,2221.74],[0.142386,0.74205,-0.536828,-0.375368],[-1,0,1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_calibration;
MoveJ [[-1092.41,1400.04,2540.36],[0.0967793,0.52186,-0.769782,-0.354583],[-2,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj_calibration;

! Clear collision zone 1 with robot 65R04
MoveJ_CollClr 1, [[-149.43,2021.19,1928.03],[0.0379876,0.0416296,-0.997542,-0.0416094],[-2,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj_calibration;

MoveJ_JobFinished 15, [[-149.41,2021.18,1928.01],[0.0379829,0.0416281,-0.997543,-0.0416039],[-2,0,1,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,fine,t_Grp1\Wobj:=wobj_calibration;

GrpPartChk low, GR01_B01PP\Part2:=GR01_B02PP\Part3:=GR01_B03PP\Part4:=GR01_B04PP;
GrpPartChk low, GR01_B05PP\Part2:=GR01_B06PP;
GrpSet Opn, Grp_11\Grp2:=Grp_12\Grp3:=Grp_13\Grp4:=Grp_14\noGripChk;

MoveAbsJ jpHome1,vmax,fine,t_Grp1\Wobj:=wobj_calibration;

!Disonnect Best Fit PC
BF_IOEXIT;

RETURN;
ENDPROC !(Calibration_Grp)


PROC Service_Grp1()
!***********************************************
!* Program : Service routine for Gripper 1     *
!* Location: 3FL5MBG16      65R02              *
!***********************************************
!*           Update Section                    *
!*          ================                   *
!* Date:     17/08/2013                        *
!* Engineer: Rafal Cieslinski / Staudinger     *
!* Changes:  create                            *
!*                                             *
!***********************************************

WaitDO SYS_do_Home_1, 1;
!****************************************************
!*   Wait until robot is close to Home 1 position   *
!****************************************************
MoveAbsJ jpHome1\NoEOffs, vmax, fine, t_Grp1\WObj:=wobj0;

GrpPartChk low, GR01_B01PP\Part2:=GR01_B02PP\Part3:=GR01_B03PP\Part4:=GR01_B04PP;
GrpPartChk low, GR01_B05PP\Part2:=GR01_B06PP;
GrpChk Opn, Grp_11\Grp2:=Grp_12\Grp3:=Grp_13\Grp4:=Grp_14;

MoveJ [[-742.17,-869.58,2755.70],[0.645591,0.266579,0.13547,-0.702706],[-2,-1,1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj0;
MoveJ [[-1557.98,-846.95,938.25],[0.314525,0.63548,0.32695,-0.624773],[-2,-1,1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj0;
MoveJ [[-1538.37,-882.00,342.03],[0.415667,0.64044,0.405244,-0.502826],[-2,-1,1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj0;

MoveJ pService1, vmax, fine, t_Grp1\WObj:=wobj0;

PLC_Release "Service position reached"\Set_:=PLC_do_ServicePos\Wait_:=PLC_di_ServicePosAck;
!********************************************
!*     Waiting for PLC to acknowledge       *
!*          maintenance position            *
!********************************************

MoveJ [[-1538.37,-882.00,342.03],[0.415667,0.64044,0.405244,-0.502826],[-2,-1,1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj0;
MoveJ [[-1557.98,-846.95,938.25],[0.314525,0.63548,0.32695,-0.624773],[-2,-1,1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj0;
MoveJ [[-742.17,-869.58,2755.70],[0.645591,0.266579,0.13547,-0.702706],[-2,-1,1,1],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]], vmax, z200, t_Grp1\WObj:=wobj0;

MoveAbsJ jpHome1\NoEOffs, vmax, fine, t_Grp1\WObj:=wobj0;

RETURN;
ENDPROC !(Service_Grp1)


PROC Service_Clean()
!***********************************************
!* Program:  Service routine for cleaning      *
!* Location: 3FL5MBG16      65R04              *
!***********************************************
!*               Update Section                *
!*              ================               *
!* Date:     14/12/2013                        *
!* Engineer: Rafal Cieslinski / Staudinger     *
!* Changes:  Created                           *
!*                                             *
!***********************************************

!Program from Home pos to Service pos with the correct tool set
MoveAbsJ jpHome1,vmax,fine,t_Grp1\WObj:=wobj0;

!Service Clean Position
MoveJ pService6, vmax, fine,t_Grp1\WObj:=wobj0;

PLC_Release "ServicePos erreicht/achieved"\Set_:=PLC_do_ServicePos\Wait_:=PLC_di_ServicePosAck;

MoveAbsJ jpHome1,vmax,fine,t_Grp1\WObj:=wobj0;

RETURN;
ENDPROC !(Service_Clean)


PROC BrakeTest()
!***********************************************
!* Program:  Brake Test                        *
!* Location: 3FL5MBG16      65R02              *
!***********************************************
!*              Update Section                 *
!*             ================                *
!* Date:     17/08/2013                        *
!* Engineer: Rafal Cieslinski / Staudinger     *
!* Changes:  Created                           *
!*                                             *
!***********************************************

WaitDO SYS_do_Home_1, high;
!**************************************
!*   Wait for robot to be in Home 1   *
!**************************************

t_Home := CTool();
MoveAbsJ jpHome1\NoEOffs, v100, fine, t_Home;

SM1_BrakeTest;

MoveAbsJ jpHome1\NoEOffs, vmax, fine, t_Home;

RETURN;
ENDPROC !(BrakeTest)


PROC Home1_Home2()

MoveAbsJ jpHome1, vmax, z50, t_Grp1\WObj:=wobj_65fx02;
MoveJ [[472.33,107.64,1609.49],[0.117282,0.985749,0.109507,0.0504991],[-2,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx02;

MoveJ [[688.68,228.96,1969.52],[0.18329,0.961072,0.165188,0.124326],[-2,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx02;
MoveJ [[1264.03,1399.98,2797.32],[0.247007,0.685386,0.657547,0.192003],[-2,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx02;

MoveJ [[594.59,1929.71,3486.11],[0.0147072,0.414323,0.745382,0.522039],[-1,-1,2,4],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx02;
MoveJ [[16.26,1880.65,4062.09],[0.532564,0.187101,-0.365621,-0.74006],[0,0,2,4],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx02;

MoveAbsJ jpHome2,vmax,z50,t_Grp1\Wobj:=wobj_65fx02;

RETURN;
ENDPROC


PROC Home2_Home1()
MoveAbsJ jpHome2,vmax,z50,t_Grp1\Wobj:=wobj_65fx02;
MoveJ [[16.26,1880.65,4062.09],[0.532564,0.187101,-0.365621,-0.74006],[0,0,2,4],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx02;
MoveJ [[594.59,1929.71,3486.11],[0.0147072,0.414323,0.745382,0.522039],[-1,-1,2,4],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx02;
MoveJ [[1264.03,1399.98,2797.32],[0.247007,0.685386,0.657547,0.192003],[-2,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx02;
MoveJ [[688.68,228.96,1969.52],[0.18329,0.961072,0.165188,0.124326],[-2,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx02;
MoveJ [[472.33,107.64,1609.49],[0.117282,0.985749,0.109507,0.0504991],[-2,0,2,0],[9E+09,9E+09,9E+09,9E+09,9E+09,9E+09]],vmax,z200,t_Grp1\Wobj:=wobj_65fx02;

MoveAbsJ jpHome1, vmax, z50, t_Grp1\WObj:=wobj_65fx02;

RETURN;
ENDPROC 


ENDMODULE
